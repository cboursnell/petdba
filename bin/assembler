#!/usr/bin/env ruby

require 'trollop'
require 'assembler'

opts = Trollop::options do

  banner <<-EOS

  Assembler v0.0.1 by Chris Boursnell (cmb211@cam.ac.uk)

  OPTIONS:

  EOS
  opt :left, "fastq file", :type => String, :required => true
  opt :right, "fastq file", :type => String
  opt :search,
      "file containing start and end kmers to search", :type => String,
      :require => true
  opt :k, "k", :type => :int, :default => 21
  opt :memory, "memory in GB", :type => :int, :default => 1
  opt :tables, "tables", :type => :int, :default => 3
end

table_size = (1e9*opts.memory/opts.tables).to_i
memory = (1e9*opts.memory).to_i

a = Assembler::Assembler.new(table_size, opts.tables, opts.k)

a.load_fastq_file opts.left
if opts.right
  a.load_fastq_file opts.right
end

if !File.exist?(opts.search)
  abort "Can't find #{opts.search}"
end

File.open("#{opts.search}") do |io|
  start = io.readline.chomp
  goal = io.readline.chomp
end

bestpath = a.bfsearch(start, goal)

puts bestpath
